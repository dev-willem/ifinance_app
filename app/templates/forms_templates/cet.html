{% from "components/simulation_table.html" import render_simulation_table %}

{% block main_content %}
<section class="simulation-container">
    <h2>CUSTO EFETIVO TOTAL (CET)</h2>

    <form method="post" action="{{ url_for('main.simulate_cet') }}" class="simulation-form cet-grid">
        <div class="form-group">
            <label for="valor-ce">Valor do Crédito (R$):</label>
            <input type="number" name="principal_value" id="valor-ce" required>
        </div>
        <div class="form-group">
            <label for="prazo-ce">Prazo (meses):</label>
            <input type="number" name="months" id="prazo-ce" required>
        </div>
        <div class="form-group">
            <label for="juros-ce">Taxa de Juros (% a.m.):</label>
            <input type="number" step="0.01" name="interest_rate" id="juros-ce" required>
        </div>
        <div class="form-group">
            <label for="tarifas">Tarifas Admin. (R$):</label>
            <input type="number" name="admin_fees" id="tarifas" required>
        </div>
        <div class="form-group">
            <label for="seguros">Seguros (R$):</label>
            <input type="number" name="insurance" id="seguros" required>
        </div>
        <div class="form-group">
            <label for="impostos-ce">Impostos (%):</label>
            <input type="number" step="0.01" name="taxes" id="impostos-ce" required>
        </div>
        <button type="submit" class="btn success">Calcular CET</button>
    </form>

    {% if tabela %}
        {% set resumo_cet = {
            "capital_inicial": capital_inicial,
            "juros_totais": juros_totais,
            "montante": montante,
            "prazo": prazo,
            "taxa_juros": taxa_juros
        } %}
        {# Adicionando o campo extra de CET no resumo antes de enviar para a macro #}
        <div class="cet-highlight">
            <strong>CET Calculado: {{ cet_percent }}%</strong>
        </div>
        {{ render_simulation_table("Resultado da Simulação - CET", tabela, resumo_cet) }}
    {% endif %}
</section>
{% endblock %}